{% extends 'base.html' %}
{% block title %}Chick Pay - ì†¡ê¸ˆí•˜ê¸°{% endblock %}

{% block content %}
<main class="container mx-auto px-4 py-10 flex-grow">
    <div class="max-w-2xl mx-auto">
        <h2 class="text-3xl font-bold text-chick-brown mb-8 text-center">ì†¡ê¸ˆí•˜ê¸°</h2>

        <div class="bg-white rounded-3xl shadow-lg p-8 border-3 border-chick-yellow">
            <form id="transfer-form" action="{% url 'cash-transfer' %}" method="POST">
                {% csrf_token %}
                
                <div class="mb-6">
                    <label for="to-account" class="block mb-2 font-semibold text-gray-600">ë³´ë‚´ëŠ” ì‚¬ëŒ : {{name}}</label>
                    <label type="" id="to-account"  required
                        class="block mb-2 font-semibold text-gray-600">ì´ë©”ì¼ : {{email}}</label>
                </div>

                <div class="mb-6">
                    <label for="to-mail" class="block mb-2 font-semibold text-gray-600">ë°›ëŠ” ì‚¬ëŒ ì´ë©”ì¼</label>

                    <input type="mail" id="to-mail" name="receiver_email" placeholder="ë°›ëŠ” ë¶„ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required
                        class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-chick-orange focus:outline-none transition">
                </div>

                <div class="mb-6">
                    <label for="amount" class="block mb-2 font-semibold text-gray-600">ì†¡ê¸ˆ ê¸ˆì•¡</label>
                    <div class="relative">
                        <span class="absolute left-3 top-3 text-gray-500">â‚©</span>
                        <input type="number" id="amount" name="amount" placeholder="0" required min="1000" step="1000"
                            class="w-full p-3 pl-8 border-2 border-gray-200 rounded-xl focus:border-chick-orange focus:outline-none transition">
                    </div>
                </div>

                <div class="mb-8">
                    <label for="memo" class="block mb-2 font-semibold text-gray-600">ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
                    <input type="text" id="memo" name="memo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                        class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-chick-orange focus:outline-none transition">
                </div>

                <div class="flex items-center mb-6">
                    <input type="checkbox" id="save-recipient" class="mr-2">
                    <label for="save-recipient" class="text-sm text-gray-600">ìì£¼ ì“°ëŠ” ê³„ì¢Œë¡œ ì €ì¥</label>
                </div>

                <button type="submit"
                    class="w-full bg-chick-yellow text-chick-brown font-bold py-4 px-6 rounded-xl shadow-md hover:bg-chick-orange transition transform hover:-translate-y-0.5 active:translate-y-0">
                    ì†¡ê¸ˆí•˜ê¸° ğŸ¥
                </button>
            </form>
        </div>

        
    </div>
</main>


<!-- <script>
    // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
    const menuButton = document.querySelector('button');
    const nav = document.querySelector('nav');

    menuButton.addEventListener('click', function () {
        if (nav.classList.contains('hidden')) {
            nav.classList.remove('hidden');
            nav.classList.add('flex', 'flex-col', 'absolute', 'top-16', 'right-4', 'bg-white', 'p-4', 'rounded-xl', 'shadow-lg', 'z-50');
        } else {
            nav.classList.add('hidden');
            nav.classList.remove('flex', 'flex-col', 'absolute', 'top-16', 'right-4', 'bg-white', 'p-4', 'rounded-xl', 'shadow-lg', 'z-50');
        }
    });

    // ê³„ì¢Œë²ˆí˜¸ ìˆ«ìë§Œ ì…ë ¥
    document.getElementById('to-account').addEventListener('input', function (e) {
        e.target.value = e.target.value.replace(/\D/g, '');
    });

    // ìì£¼ ì“°ëŠ” ê³„ì¢Œ ì„ íƒ
    function fillRecipient(name, bank, account) {
        document.getElementById('to-name').value = name;

        const bankSelect = document.getElementById('to-bank');
        for (let i = 0; i < bankSelect.options.length; i++) {
            if (bankSelect.options[i].text === bank) {
                bankSelect.selectedIndex = i;
                break;
            }
        }

        document.getElementById('to-account').value = account.replace(/\D/g, '');
    }

    // âœ… ì†¡ê¸ˆ API í˜¸ì¶œ
    document.getElementById('transfer-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const fromAccount = document.getElementById('from-account').value;
        const toAccount = document.getElementById('to-account').value;
        const amount = document.getElementById('amount').value;

        const button = this.querySelector('button');
        button.textContent = 'ì²˜ë¦¬ ì¤‘...';
        button.disabled = true;

        try {
            const res = await fetch('/transfer/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    from_id: fromAccount,
                    to_id: toAccount,
                    amount: amount
                })
            });

            const data = await res.json();

            if (res.ok) {
                window.location.href = '/transfer/complete/';
            } else {
                alert('ì†¡ê¸ˆ ì‹¤íŒ¨: ' + data.error);
                button.textContent = 'ì†¡ê¸ˆí•˜ê¸° ğŸ¥';
                button.disabled = false;
            }
        } catch (err) {
            alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
            button.textContent = 'ì†¡ê¸ˆí•˜ê¸° ğŸ¥';
            button.disabled = false;
        }
    });

    // âœ… CSRF í† í° ê°€ì ¸ì˜¤ê¸° (Djangoìš©)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script> -->
{% endblock %}